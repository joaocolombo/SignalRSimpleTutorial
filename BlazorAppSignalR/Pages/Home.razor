@page "/"
@using Microsoft.AspNetCore.SignalR.Client

<PageTitle>Home</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.

<input type="text" @bind="message" />
<button @onclick="SendMessage">Send</button>

@foreach (var message in _messages)
{
    <div>@message</div>
}
@foreach (var time in _time)
{
    <div>@time</div>
}

@code
{
    private List<string> _messages = new();
    private List<string> _time = new();
    private HubConnection hubConnection;
    private string message;


    protected override async Task OnInitializedAsync()
    {
        hubConnection = new HubConnectionBuilder()
            .WithUrl("https://localhost:7238/chat")
            .Build();

        hubConnection.On<Guid>("ReceiveMessage", guid =>
        {
            _messages.Add($"receive from server: {guid}");
            InvokeAsync(StateHasChanged);
        });


        await hubConnection.StartAsync();
    }

    public async Task SendMessage()
    {
        if (string.IsNullOrEmpty(message))
        {
            message = "empty";
        }
        await hubConnection.SendAsync("SendMessage", $"From blazor client: {message}");
            message = string.Empty;
    }
}